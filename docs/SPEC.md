# アルゴリズム仕様書 (Algorithm Context)

## 重点出題 (Weighted Lottery System)

Reviewモードにおける「次の一問」を決定するための出題ロジック `getNextQuestion` (`src/logic/scheduler.ts`) の仕様です。

### 概要

完全なランダムではなく、学習者の苦手傾向に基づいた「重み付け抽選」を行います。
基本ウェイトに対し、以下の条件でスコアを加算し、その合計ウェイトに基づいて確率的に抽選します。

### ウェイト計算ルール

| 条件 | 加算ポイント | 意図 |
| :--- | :--- | :--- |
| **基本値 (Base)** | **10** | 全ての問題が最低限選ばれる可能性を持つ |
| **直近の間違い (Recent Errors)** | **+20** | 直近10回の回答履歴で間違えた文型と同じ文型の問題 |
| **混同ペア (Confusion Pairs)** | **+20** | ユーザーが最もよく間違える「正解と回答のペア」Top3に含まれる文型。<br>例: SVOをSVOCと間違える傾向がある場合、SVOとSVOCの両方の出現率が上がる |
| **連続回避 (Anti-Repetition)** | **x 0.1** | 直前に出題された問題と同じ文型の場合、ウェイトを1/10にする (連続出題の抑制) |

### 混同行列 (Confusion Matrix)

ユーザーの弱点を分析するために、`src/logic/stats.ts` にて以下のペアを集計しています。

*   `CorrectPattern` : `ChosenPattern`
*   例: `4:5` (正解は第4文型だが、第5文型と答えた)

この発生回数が多い上位3つのペアに関係する文型を「苦手文型」と定義し、Reviewモードで重点的に出題します。
これにより、ユーザーは自分の苦手なパターンの識別能力を集中的にトレーニングできます。
